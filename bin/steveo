#!/usr/bin/env node

const program = require('commander');
const { default: Steveo } = require('../lib/');

const handler = async (pattern = null, config = null, queues = false) => {
  const steveo = Steveo.build(config, pattern);
  const runner = steveo.runner();

  if (queues) {
    return runner.createQueues();
  }

  await runner.process();
  return true;
};

program
  .version('0.0.1')
  .option('-p, --pattern [pattern]', 'glob of tasks')
  .option('-c, --config [config]', 'config to use')
  .option('-q, --create-queues', 'create queues')
  .parse(process.argv);

handler(program.pattern, program.config, program.topics)
.catch((e) => {
  console.error(e);
  process.exit(1);
});
